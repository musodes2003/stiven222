import React, { useState, useEffect } from 'react';

export default function AnimalMatchGame() {
  const animals = ['üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº', 'üê®', 'üêØ', 'ü¶Å', 'üêÆ'];
  
  const [cards, setCards] = useState([]);
  const [flipped, setFlipped] = useState([]);
  const [matched, setMatched] = useState([]);
  const [moves, setMoves] = useState(0);
  const [gameStarted, setGameStarted] = useState(false);
  const [gameWon, setGameWon] = useState(false);
  const [gameLost, setGameLost] = useState(false);
  const [time, setTime] = useState(40);
  const [bestScore, setBestScore] = useState(null);

  useEffect(() => {
    let timer;
    if (gameStarted && !gameWon && !gameLost && time > 0) {
      timer = setInterval(() => {
        setTime(t => {
          if (t <= 1) {
            setGameLost(true);
            setGameStarted(false);
            return 0;
          }
          return t - 1;
        });
      }, 1000);
    }
    return () => clearInterval(timer);
  }, [gameStarted, gameWon, gameLost, time]);

  useEffect(() => {
    if (matched.length === cards.length && cards.length > 0) {
      setGameWon(true);
      setGameStarted(false);
      const score = matched.length / 2;
      if (!bestScore || score > bestScore) {
        setBestScore(score);
      }
    }
  }, [matched, cards, bestScore]);

  const initGame = () => {
    const shuffledAnimals = [...animals].sort(() => Math.random() - 0.5).slice(0, 8);
    const gamecards = [...shuffledAnimals, ...shuffledAnimals]
      .sort(() => Math.random() - 0.5)
      .map((animal, index) => ({
        id: index,
        animal,
        isFlipped: false,
        isMatched: false
      }));
    
    setCards(gamecards);
    setFlipped([]);
    setMatched([]);
    setMoves(0);
    setTime(40);
    setGameStarted(true);
    setGameWon(false);
    setGameLost(false);
  };

  const handleCardClick = (index) => {
    if (!gameStarted || flipped.length === 2 || flipped.includes(index) || matched.includes(index)) {
      return;
    }

    const newFlipped = [...flipped, index];
    setFlipped(newFlipped);

    if (newFlipped.length === 2) {
      setMoves(m => m + 1);
      const [first, second] = newFlipped;
      
      if (cards[first].animal === cards[second].animal) {
        setMatched([...matched, first, second]);
        setFlipped([]);
      } else {
        setTimeout(() => {
          setFlipped([]);
        }, 800);
      }
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-pink-300 via-purple-300 to-blue-300 p-4 flex items-center justify-center">
      <div className="bg-white rounded-3xl shadow-2xl p-6 max-w-2xl w-full">
        <div className="text-center mb-6">
          <h1 className="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-purple-500 to-blue-500 mb-2">
            üêæ Animal Match
          </h1>
          <p className="text-gray-600">Find all pairs before time runs out!</p>
        </div>

        <div className="flex justify-between items-center mb-6 bg-gradient-to-r from-pink-100 to-purple-100 rounded-xl p-4">
          <div className="text-center">
            <div className="text-sm text-gray-600 font-semibold">Moves</div>
            <div className="text-2xl font-bold text-purple-600">{moves}</div>
          </div>
          <div className="text-center">
            <div className="text-sm text-gray-600 font-semibold">Time Left</div>
            <div className={`text-3xl font-bold ${time <= 10 ? 'text-red-600 animate-pulse' : 'text-blue-600'}`}>
              {time}s
            </div>
          </div>
          <div className="text-center">
            <div className="text-sm text-gray-600 font-semibold">Pairs Found</div>
            <div className="text-2xl font-bold text-green-600">
              {matched.length / 2} / 8
            </div>
          </div>
        </div>

        {!gameStarted && !gameWon && !gameLost && (
          <div className="text-center py-16">
            <button
              onClick={initGame}
              className="px-10 py-5 bg-gradient-to-r from-pink-500 via-purple-500 to-blue-500 text-white text-2xl font-bold rounded-2xl hover:from-pink-600 hover:via-purple-600 hover:to-blue-600 transform hover:scale-105 transition-all shadow-lg"
            >
              Start Game üéÆ
            </button>
          </div>
        )}

        {gameWon && (
          <div className="text-center py-8 bg-gradient-to-r from-yellow-100 to-orange-100 rounded-2xl mb-6">
            <div className="text-5xl mb-4">üéâ</div>
            <h2 className="text-3xl font-bold text-orange-600 mb-2">You Won!</h2>
            <p className="text-lg text-gray-700 mb-1">Time Remaining: {time}s</p>
            <p className="text-lg text-gray-700 mb-4">Moves: {moves}</p>
            <button
              onClick={initGame}
              className="px-8 py-3 bg-gradient-to-r from-pink-500 to-purple-500 text-white text-xl font-bold rounded-xl hover:from-pink-600 hover:to-purple-600 transform hover:scale-105 transition-all shadow-lg"
            >
              Play Again
            </button>
          </div>
        )}

        {gameLost && (
          <div className="text-center py-8 bg-gradient-to-r from-red-100 to-pink-100 rounded-2xl mb-6">
            <div className="text-5xl mb-4">‚è∞</div>
            <h2 className="text-3xl font-bold text-red-600 mb-2">Time's Up!</h2>
            <p className="text-lg text-gray-700 mb-1">Pairs Found: {matched.length / 2} / 8</p>
            <p className="text-lg text-gray-700 mb-4">Moves: {moves}</p>
            <button
              onClick={initGame}
              className="px-8 py-3 bg-gradient-to-r from-pink-500 to-purple-500 text-white text-xl font-bold rounded-xl hover:from-pink-600 hover:to-purple-600 transform hover:scale-105 transition-all shadow-lg"
            >
              Try Again
            </button>
          </div>
        )}

        {gameStarted && (
          <div className="grid grid-cols-4 gap-3">
            {cards.map((card, index) => {
              const isFlipped = flipped.includes(index) || matched.includes(index);
              const isMatched = matched.includes(index);
              
              return (
                <button
                  key={card.id}
                  onClick={() => handleCardClick(index)}
                  disabled={isMatched}
                  className={`aspect-square rounded-xl shadow-lg transition-all duration-300 transform hover:scale-105 ${
                    isMatched ? 'opacity-0 scale-0' : 'opacity-100'
                  }`}
                  style={{
                    perspective: '1000px'
                  }}
                >
                  <div
                    className="relative w-full h-full transition-transform duration-500"
                    style={{
                      transformStyle: 'preserve-3d',
                      transform: isFlipped ? 'rotateY(180deg)' : 'rotateY(0deg)'
                    }}
                  >
                    {/* Card Back */}
                    <div
                      className="absolute w-full h-full bg-gradient-to-br from-purple-400 to-pink-400 rounded-xl flex items-center justify-center border-4 border-white"
                      style={{
                        backfaceVisibility: 'hidden'
                      }}
                    >
                      <div className="text-4xl">‚ùì</div>
                    </div>
                    
                    {/* Card Front */}
                    <div
                      className="absolute w-full h-full bg-gradient-to-br from-yellow-200 to-orange-200 rounded-xl flex items-center justify-center border-4 border-white"
                      style={{
                        backfaceVisibility: 'hidden',
                        transform: 'rotateY(180deg)'
                      }}
                    >
                      <div className="text-5xl">{card.animal}</div>
                    </div>
                  </div>
                </button>
              );
            })}
          </div>
        )}

        {gameStarted && (
          <div className="mt-6 text-center">
            <button
              onClick={initGame}
              className="px-6 py-2 bg-gray-500 text-white font-semibold rounded-lg hover:bg-gray-600 transition-all"
            >
              New Game
            </button>
          </div>
        )}

        <div className="mt-6 text-center text-sm text-gray-500">
          <p>You have 40 seconds to find all 8 pairs! ‚è±Ô∏è</p>
        </div>
      </div>
    </div>
  );
}